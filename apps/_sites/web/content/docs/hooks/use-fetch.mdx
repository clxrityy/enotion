import { Table } from "@enotion/components";

## Table of Contents

- [Overview](#overview)
- [Installation](#installation)
- [Usage](#usage)
- [Parameters](#parameters)
- [Return Value](#return-value)
- [Examples](#examples)
- [Type Definitions](#type-definitions)

## Overview

The **useFetch** hook is a custom React hook that simplifies the process of fetching data from an API endpoint. It takes a URL and optional fetch initialization parameters as arguments and returns an object containing the fetched data, loading state, and error state.

## Installation

```bash
pnpm add @enotion/hooks
```

## Usage

```tsx
import { useFetch } from "@enotion/hooks";
```

## Parameters

<Table rows={[
  { title: "Parameter", items: ["Type", "Default", "Description"] },
  { title: "**url**", items: ["`string`", "Required", "The URL to fetch data from"] },
  { title: "**init**", items: ["`RequestInit`", "`undefined`", "Optional fetch initialization parameters (method, headers, body, etc.)"] }
]} />

## Return Value

Returns an object with the following properties:

<Table rows={[
  { title: "Property", items: ["Type", "Description"] },
  { title: "**data**", items: ["`T | null`", "The fetched data (typed according to the generic parameter)"] },
  { title: "**loading**", items: ["`boolean`", "Indicates whether the fetch operation is in progress"] },
  { title: "**error**", items: ["`Error | null`", "Contains any error that occurred during the fetch operation"] }
]} />

## Examples

### Basic GET Request

```tsx
"use client";
import { useFetch } from "@enotion/hooks";

interface User {
  id: number;
  name: string;
  email: string;
}

function UserProfile() {
  const { data, loading, error } = useFetch<User>(
    "https://api.example.com/user/1"
  );

  if (loading) return <p>Loading...</p>;
  if (error) return <p>Error: {error.message}</p>;

  return (
    <div>
      <h1>{data?.name}</h1>
      <p>{data?.email}</p>
    </div>
  );
}
```

### POST Request with Headers

```tsx
"use client";
import { useFetch } from "@enotion/hooks";

interface CreateUserResponse {
  id: number;
  success: boolean;
}

function CreateUser() {
  const { data, loading, error } = useFetch<CreateUserResponse>(
    "https://api.example.com/users",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": **Bearer ${token}**
      },
      body: JSON.stringify({
        name: "John Doe",
        email: "john@example.com"
      })
    }
  );

  if (loading) return <p>Creating user...</p>;
  if (error) return <p>Error: {error.message}</p>;
  if (data?.success) return <p>User created with ID: {data.id}</p>;

  return null;
}
```

### Fetching a List of Items

```tsx
"use client";
import { useFetch } from "@enotion/hooks";

interface Post {
  id: number;
  title: string;
  body: string;
}

function PostsList() {
  const { data, loading, error } = useFetch<Post[]>(
    "https://api.example.com/posts"
  );

  if (loading) return <div>Loading posts...</div>;
  if (error) return <div>Failed to load posts: {error.message}</div>;

  return (
    <div>
      {data?.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.body}</p>
        </article>
      ))}
    </div>
  );
}
```

### With Authentication Headers

```tsx
"use client";
import { useFetch } from "@enotion/hooks";

interface ProtectedData {
  message: string;
  userId: number;
}

function ProtectedResource() {
  const token = "your-auth-token";

  const { data, loading, error } = useFetch<ProtectedData>(
    "https://api.example.com/protected",
    {
      method: "GET",
      headers: {
        "Authorization": **Bearer ${token}**,
        "Content-Type": "application/json"
      }
    }
  );

  if (loading) return <p>Loading protected data...</p>;
  if (error) return <p>Authentication failed: {error.message}</p>;

  return (
    <div>
      <p>{data?.message}</p>
      <p>User ID: {data?.userId}</p>
    </div>
  );
}
```

## Type Definitions

```tsx
export type Fetcher = <T>(
  url: string,
  init?: RequestInit,
) => {
  data: T;
  loading: boolean;
  error: Error | null;
};
```

## Notes

- The hook automatically handles JSON parsing of the response
- The fetch is triggered on component mount
- If the URL or init options change, the fetch will be re-triggered
- Error handling includes both network errors and HTTP error responses
- The **loading** state is automatically set to **false** once the fetch completes (successfully or with an error)
